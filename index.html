<html>
<head>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="http://code.highcharts.com/stock/highstock.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.3/moment.min.js"></script>
    <script>
		Highcharts.setOptions({
			global: {
				useUTC: false
			}
		});
        function fileSelected(files) {
            var reader = new FileReader();
            reader.onload = function(e) { setChart(JSON.parse(e.target.result)); };
            reader.readAsText(files[0]);
        }
        function setChart(d) {
            var data = correctData(d);
            console.log(data);
            var startOfToday = moment().startOf('day').valueOf();
            $("#chart").highcharts("StockChart",
            {
                credits: { enabled: false },
                exporting: { enabled: false },
                series: [{
                    name: "Number of tabs open in Firefox",
                    data: data
                }],
				xAxis: {
                    min: startOfToday,
					ordinal: false
				},
                yAxis: {
                    max: 85,
                    min: 0
                }
            });
        }
		function correctData(data) {
			// insert data points over long time periods
			for (var i=1; i<data.length; i++) {
                if (data[i][0] - data[i-1][0] > 16) {
                    //then we need to insert a new point
                    data.splice(i, 0, [data[i][0]-15, data[i-1][1]]);
                }
            }
			// multiply times by 1000
			$.each(data, function(_,e) {
                e[0] = e[0]*1000;
            });
            return data;
		}
        $(document).ready(function() {
            $("input[type=file]").change(function() { fileSelected(this.files); });
            $("button").click(function() { console.log("hello"); fileSelected($("input[type=file]")[0].files); });
        });
    </script>
    <style>
    body {
        font-family: "Helvetica";
    }
    </style>
</head>
<body>
    <div>Select the JSON file: <input type="file" id="input" onchange="fileSelected(this.files)"><button>Refresh</button></div>
    <div id="chart"></div>
</body>
</html>
